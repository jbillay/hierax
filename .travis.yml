sudo: required
language: node_js
services:
  - docker
env: DOCKER_COMPOSE_VERSION=1.18.0
before_install:
  - sudo /etc/init.d/mysql stop
  - npm install codecov -g
  - sudo apt update -y
  - sudo apt install --only-upgrade docker-ce -y
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  - docker info
  - sudo chown -R 100:1001 .
script:
  - docker-compose -f docker-compose-travis.yml -p hierax build
  - docker-compose -f docker-compose-travis.yml -p hierax up
  - docker ps -a
  - docker-compose exec hierax-api npm test
after_success:
  - sudo pip install codecov
  - codecov
deploy:
  provider: heroku
  api_key:
    secure: TempkZWk+KijJx0MXCRMsEUGsEyQfYbQF8w6gtPbn2CymhtfvNJr/As37vdaeujA+bq2IZzXOisO81WxMeSFBV1YTIkpSErKRHKBO7U//ydl53KPz6g41wBxeW0VG9AbJMPkQOmuU2JInTKFzc+1T7S9Or9i8bhKoQ4wGCF15OCQwmA7eV98AcslbQgUaDjYIkrSg5B+0eb1jPA5bVM/TLu81h4CMZN7K5vtWC/EXyYn50tGEtlFpg8WXf5JA0YnO+tc47fYMdAsCc2zeHOPyX5sRhYWICSNbfACj/WuLBkxFByTNGcN2RSsWjpUZcdDlwtkLGJGsCokTepIyv0zF9ld1+ndULIOvKBHDxP7/a/aZJWhTSQAI7JWZ+8PJrsaD12pvl5JlV3ftp75VrhWWok5zVXfXRHU0F4OeH1ozgHiEqlBfyWu/phLdk6uotjo3IvzqAIzx6mDzbYWr87I9jc4r5qrFAMKsRL9H2QHDhH37rsVm8osJHyAzkTp1Ig0L2cL4LgHEOZlRMkcdvcbY7FTL1nXhcuLIqZ5BJq5cdkNW4DQ9cawxEPW/KZIFjnpiTFO173wdAc1s+fXJKwUa/+X1y1O4WaVofQTYASHDCoiPVQPOEajM0HhWqb0igXoFTojZ14nHN1GJR4tW01iFvEDzRn8CnoK3ugF2c/42RE=
